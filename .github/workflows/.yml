name: PMD Static Analysis

on:
  push: # Run on all branches for push events
    branches:
      - '**'

jobs:
  pmd-check:
    runs-on: ubuntu-latest
    steps:
      # Checkout the repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # Install Java (required for PMD)
      - name: Set up Java
        uses: actions/setup-java@v3
        with:
          java-version: '11' # PMD requires Java 11 or higher
          distribution: 'temurin' # Use Eclipse Temurin as the Java distribution

      # Download and install PMD 7.8.0
      - name: Install PMD
        run: |
          # Download PMD 7.8.0 binary distribution
          curl -L -o pmd-bin.zip https://github.com/pmd/pmd/releases/download/pmd_releases%2F7.8.0/pmd-dist-7.8.0-bin.zip
          
          # Extract the PMD zip file
          unzip -o pmd-bin.zip -d pmd
          
          # Move the extracted folder to /opt/pmd
          sudo mv pmd/pmd-bin-7.8.0 /opt/pmd
          
          # Add PMD to the PATH (for subsequent steps)
          echo "/opt/pmd/bin" >> $GITHUB_PATH
          
          # Verify the installation
          ls -la /opt/pmd/bin    # List the PMD binary directory
          pmd -version           # Confirm PMD is installed and accessible

      # Run PMD on HTML files
      - name: Run PMD on HTML files
        run: pmd check -f text -R .github/rulesets/html.xml -d ./

      # Run PMD on JS files
      - name: Run PMD on JS files
        run: pmd check -f text -R .github/rulesets/js.xml -d ./